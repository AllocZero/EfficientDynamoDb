"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[8089],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>y});var i=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=i.createContext({}),p=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=p(e.components);return i.createElement(s.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},c=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=p(n),c=a,y=u["".concat(s,".").concat(c)]||u[c]||m[c]||r;return n?i.createElement(y,o(o({ref:t},d),{},{components:n})):i.createElement(y,o({ref:t},d))}));function y(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[u]="string"==typeof e?e:a,o[1]=l;for(var p=2;p<r;p++)o[p]=n[p];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}c.displayName="MDXCreateElement"},1820:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>m,frontMatter:()=>r,metadata:()=>l,toc:()=>p});var i=n(7462),a=(n(7294),n(3905));const r={id:"write",title:"Writing Data",slug:"../dev-guide/high-level/write"},o=void 0,l={unversionedId:"dev_guide/high_level/write",id:"dev_guide/high_level/write",title:"Writing Data",description:"DynamoDB provides three primary operations for writing data:",source:"@site/docs/dev_guide/high_level/write.md",sourceDirName:"dev_guide/high_level",slug:"/dev_guide/dev-guide/high-level/write",permalink:"/EfficientDynamoDb/docs/dev_guide/dev-guide/high-level/write",draft:!1,editUrl:"https://github.com/alloczero/EfficientDynamoDb/edit/main/website/docs/dev_guide/high_level/write.md",tags:[],version:"current",frontMatter:{id:"write",title:"Writing Data",slug:"../dev-guide/high-level/write"},sidebar:"someSidebar",previous:{title:"Reading Data",permalink:"/EfficientDynamoDb/docs/dev_guide/dev-guide/high-level/read"},next:{title:"Batch Operations",permalink:"/EfficientDynamoDb/docs/dev_guide/dev-guide/high-level/batch"}},s={},p=[{value:"PutItem",id:"putitem",level:2},{value:"UpdateItem",id:"updateitem",level:2},{value:"DeleteItem",id:"deleteitem",level:2},{value:"Conditions",id:"conditions",level:2},{value:"Compatibility API",id:"compatibility-api",level:2},{value:"SaveAsync",id:"saveasync",level:3},{value:"DeleteAsync",id:"deleteasync",level:3},{value:"Useful links",id:"useful-links",level:2}],d={toc:p},u="wrapper";function m(e){let{components:t,...n}=e;return(0,a.kt)(u,(0,i.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"DynamoDB provides three primary operations for writing data:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"PutItem")," - Creates a new item, or replaces an old item with a new item."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"UpdateItem")," - Adds or updates specific attributes of an item."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"DeleteItem")," - Deletes an item from the database.")),(0,a.kt)("p",null,"DynamoDB also supports a ",(0,a.kt)("inlineCode",{parentName:"p"},"BatchWriteItem")," operation for executing up to 25 ",(0,a.kt)("inlineCode",{parentName:"p"},"PutItem")," operations in a single request.\nIt's covered in ",(0,a.kt)("a",{parentName:"p",href:"/EfficientDynamoDb/docs/dev_guide/dev-guide/high-level/batch"},"batch operations guide"),"."),(0,a.kt)("h2",{id:"putitem"},"PutItem"),(0,a.kt)("p",null,"PutItem creates a new item or replaces an old item with a new item.\nIf an item that has the same primary key as the new item already exists in the specified table, the new item completely replaces the existing item."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'await ddbContext.PutItemAsync(new UserEntity("John", "Doe"));\n')),(0,a.kt)("p",null,"You can return the item's attribute values in the same operation by setting ",(0,a.kt)("inlineCode",{parentName:"p"},"ReturnValues")," in the fluent API.\nIt might be helpful if you want to know the item's state before or after the save.\n",(0,a.kt)("inlineCode",{parentName:"p"},"ReturnValues")," enum contains many options, but ",(0,a.kt)("inlineCode",{parentName:"p"},"PutItem")," operation only supports ",(0,a.kt)("inlineCode",{parentName:"p"},"None"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"AllOld"),", and ",(0,a.kt)("inlineCode",{parentName:"p"},"AllNew"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'var item = await ddbContext.PutItem()\n    .WithItem(new UserEntity("John", "Doe"))\n    .WithReturnValues(ReturnValues.AllOld)\n    .ToEntityAsync();\n')),(0,a.kt)("h2",{id:"updateitem"},"UpdateItem"),(0,a.kt)("p",null,"Edits an existing item's attributes or adds a new item to the table if it does not already exist.\nYou can put, delete, or add attribute values."),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"UpdateItem")," is a rather complicated operation, so you can only use a fluent API to access it.\nThe primary key and at least one update operation must be specified in every request."),(0,a.kt)("p",null,"EfficientDynamoDb provides an easy way to build update expressions.\nAll you need to do is pass an ",(0,a.kt)("inlineCode",{parentName:"p"},"Expression")," referring to the property you want to update to ",(0,a.kt)("inlineCode",{parentName:"p"},".On(...)")," method of fluent API.\nAnd then follow it with the action you want to perform, e.g. ",(0,a.kt)("inlineCode",{parentName:"p"},"Assign(...)"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'await ddbContext.UpdateItem<UserEntity>()\n    .WithPrimaryKey("partitionKey", "sortKey")\n    .On(x => x.FirstName).Assign("John")\n    .On(x => x.LastName).Assign("Doe")\n    .ExecuteAsync();\n')),(0,a.kt)("p",null,"Please, refer to ",(0,a.kt)("a",{parentName:"p",href:"/EfficientDynamoDb/docs/dev_guide/dev-guide/high-level/update-expression"},"UpdateExpression developer guide")," for more details about ",(0,a.kt)("inlineCode",{parentName:"p"},"UpdateExpression")," builder usage and tricks."),(0,a.kt)("p",null,"You can return the item's attribute values in the same operation by setting ",(0,a.kt)("inlineCode",{parentName:"p"},"ReturnValues")," in the fluent API.\nIt might be helpful if you want to know the item's state before or after the update."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'var oldValues = await ddbContext.UpdateItem<UserEntity>()\n    .WithPrimaryKey("partitionKey", "sortKey")\n    .On(x => x.FirstName).Assign("John")\n    .WithReturnValues(ReturnValues.UpdatedOld)\n    .ToEntityAsync();\n')),(0,a.kt)("h2",{id:"deleteitem"},"DeleteItem"),(0,a.kt)("p",null,"Deletes a single item in a table by primary key.\nYou can perform a conditional delete operation that deletes the item if it exists or has an expected attribute value."),(0,a.kt)("p",null,"To delete an item, you need to pass the primary key to the ",(0,a.kt)("inlineCode",{parentName:"p"},"DeleteItemAsync<T>")," method."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'// If there is only a partition key\nawait ddbContext.DeleteItemAsync<UserEntity>("partitionKey");\n\n// If your primary key consists of partition and sort key\nawait ddbContext.DeleteItemAsync<UserEntity>("partitionKey", "sortKey")\n')),(0,a.kt)("p",null,"Unless you specify conditions, the ",(0,a.kt)("inlineCode",{parentName:"p"},"DeleteItem")," is an idempotent operation.\nRunning it multiple times on the same item or attribute does not result in an error response."),(0,a.kt)("p",null,"You can use the fluent API to add more configurations to delete requests.\nIt might be useful when you want to know if your request deleted an item or it wasn't present in the table at all."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'// This call returns null if an item hasn\'t been present in the table\nvar deletedItem = await ddbContext.DeleteItem<MixedEntity>()\n    .WithPrimaryKey("partitionKey")\n    .WithReturnValues(ReturnValues.AllOld)\n    .ToItemAsync();\n')),(0,a.kt)("h2",{id:"conditions"},"Conditions"),(0,a.kt)("p",null,"Write operations in DynamoDB support conditions.\nEfficientDynamoDb provides the same fluent API for specifying write conditions for all three operations."),(0,a.kt)("p",null,"If a condition is not met, the operation will throw a ",(0,a.kt)("inlineCode",{parentName:"p"},"ConditionalCheckFailedException"),"."),(0,a.kt)("p",null,"In the following examples, we'll use this condition:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'var condition = Condition<UserEntity>.On(x => x.FirstName).EqualsTo("John");\n')),(0,a.kt)("p",null,"PutItem:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'await ddbContext.PutItem()\n    .WithItem(new UserEntity("John", "Doe"))\n    .WithCondition(condition)\n    .ExecuteAsync()\n')),(0,a.kt)("p",null,"Update:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'await ddbContext.UpdateItem<UserEntity>()\n    .WithPrimaryKey("partitionKey", "sortKey")\n    .On(x => x.FirstName).Assign("John")\n    .WithCondition(condition)\n    .ExecuteAsync();\n')),(0,a.kt)("p",null,"DeleteItem:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'await ddbContext.DeleteItem<MixedEntity>()\n    .WithPrimaryKey("partitionKey")\n    .WithCondition(condition)\n    .ExecuteAsync();\n')),(0,a.kt)("h2",{id:"compatibility-api"},"Compatibility API"),(0,a.kt)("p",null,"EfficientDynamoDb provides two extension methods, ",(0,a.kt)("inlineCode",{parentName:"p"},"SaveAsync(...)")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"DeleteAsync(...)"),", for making it easier to transition from the official AWS .NET SDK."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"It's highly recommended to use native EfficientDynamoDb API for all new features and migrate old code from these compatibility methods as soon as possible.\nTheir usage may lead to redundant RCU and WCU consumption due to suboptimal execution flow.")),(0,a.kt)("h3",{id:"saveasync"},"SaveAsync"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"SaveAsync")," looks similar to the native ",(0,a.kt)("inlineCode",{parentName:"p"},"PutItem")," calls, but in fact, it executes ",(0,a.kt)("inlineCode",{parentName:"p"},"UpdateItem")," operations.\nIt leads to several significant differences:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"It doesn't replace an item entirely, so if you remove a property from your entity class, it won't be deleted from the item in DynamoDB."),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("inlineCode",{parentName:"li"},"PutItem"),"-like behavior affects only top-level properties. E.g., if you delete or add a property to a nested object, it will be replaced entirely in DynamoDB.")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"SaveAsync")," uses the ",(0,a.kt)("a",{parentName:"p",href:"/EfficientDynamoDb/docs/dev_guide/dev-guide/high-level/attributes#DynamoDbVersion"},"DynamoDbVersion")," attribute for enabling optimistic concurrency."),(0,a.kt)("p",null,"Example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'await ddbContext.SaveAsync(new UserEntity("John", "Doe"));\n')),(0,a.kt)("h3",{id:"deleteasync"},"DeleteAsync"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"DeleteAsync")," deletes an item passed as a parameter."),(0,a.kt)("p",null,"Similar to ",(0,a.kt)("inlineCode",{parentName:"p"},"SaveAsync")," it uses the ",(0,a.kt)("a",{parentName:"p",href:"/EfficientDynamoDb/docs/dev_guide/dev-guide/high-level/attributes#DynamoDbVersion"},"DynamoDbVersion")," attribute for enabling optimistic concurrency.\nAn item will be deleted only if its version matches the version of the parameter object."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-csharp"},'await ddbContext.DeleteAsync(new UserEntity("John", "Doe"));\n')),(0,a.kt)("h2",{id:"useful-links"},"Useful links"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"API reference",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/EfficientDynamoDb/docs/api-reference/put-item"},"PutItem")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/EfficientDynamoDb/docs/api-reference/update-item"},"UpdateItem")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/EfficientDynamoDb/docs/api-reference/delete-item"},"DeleteItem")))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/EfficientDynamoDb/docs/dev_guide/dev-guide/high-level/conditions"},"Condition Builder guide"))))}m.isMDXComponent=!0}}]);